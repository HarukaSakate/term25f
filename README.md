# term25f
VM間でOBSを用いた動画配信を成功させるための手順の全体像を、設定した内容に基づいてまとめて解説します。

## 1\. ネットワーク環境の構築とIPアドレスの設定

VM間で相互に通信できるようにするため、VirtualBoxの「内部ネットワーク」機能を使用し、両方のVMに**静的IPv4アドレス**を設定します。

| 設定項目 | 配信VM（OBS側） | 受信VM（RTMPサーバー側） |
| :--- | :--- | :--- |
| **VirtualBox設定** | ネットワークアダプターを**内部ネットワーク**に設定し、**名前を一致**させる | ネットワークアダプターを**内部ネットワーク**に設定し、**名前を一致**させる |
| **IPアドレス** | **`10.0.0.20/24`** | **`10.0.0.10/24`** |
| **コマンド例** | `sudo ip addr add 10.0.0.20/24 dev enp0s3` | `sudo ip addr add 10.0.0.10/24 dev enp0s3` |

### 💡 補足

  * `10.0.0.x`のアドレスは、VMの再起動で消えることがあるため、再起動後は`ip a`で確認し、必要に応じて上記コマンドを再実行してください。
  * この設定により、配信VMから受信VMへ **`ping 10.0.0.10`** が通るようになります。

## 2\. RTMPサーバー（Nginx）の設定

配信データを受け付け、視聴者に中継するRTMPサーバーを\*\*受信VM（`10.0.0.10`）\*\*に構築します。

1.  **NginxとRTMPモジュールのインストール:**

    ```bash
    sudo apt update
    sudo apt install nginx libnginx-mod-rtmp -y
    ```

2.  **Nginx設定ファイル（`/etc/nginx/nginx.conf`）の編集:**
    ファイルの末尾に以下のRTMPブロックを追加します。

    ```nginx
    rtmp {
        server {
            listen 1935;             # RTMP標準ポート
            chunk_size 4096;
            application live {       # アプリケーション名（配信URLの一部）
                live on;
            }
        }
    }
    ```

3.  **Nginxの再起動:**
    設定を反映させ、サービスを起動します。

    ```bash
    sudo systemctl daemon-reload
    sudo systemctl restart nginx
    ```

4.  **動作確認:**
    ポート $1935$ が待ち受け状態になっていることを確認します。

    ```bash
    sudo ss -tulnp | grep 1935
    # 出力例: 0.0.0.0:1935 LISTEN
    ```

-----

## 3\. OBSからの配信設定と開始

\*\*配信VM（`10.0.0.20`）\*\*のOBSで、配信先をカスタムRTMPサーバーに設定します。

1.  **OBS「設定」→「配信」タブの設定:**

      * **サービス:** **カスタム...**
      * **サーバー (URL):** **`rtmp://10.0.0.10:1935/live`**
      * **ストリームキー:** **`myvideo`** （任意のキーを設定）

2.  **Luaスクリプトの設定:**
    動画の6回ループと自動停止を制御するLuaスクリプトを読み込み、\*\*「メディアソースを選択」\*\*のプロパティを正しく設定します。

3.  **配信開始:**
    OBSメイン画面の\*\*「配信開始」\*\*ボタンを押すと、RTMPサーバーへ動画ストリームが送信されます。

-----

## 4\. 配信を視聴する方法（VLC）

RTMPサーバーと同じVM内で、ストリームを受信・再生します。

1.  **VLC Media Playerのインストール:**

    ```bash
    sudo apt install vlc -y
    ```

2.  **VLCでの視聴URL入力:**
    VLCを起動し、「メディア」→「ネットワークストリームを開く」を選択します。同じVM内のNginxにアクセスするため、**ローカルホストアドレス**を使用するのが最も確実です。

    **視聴URL:**
    $$\text{rtmp://127.0.0.1:1935/live/myvideo}$$

    （IPアドレスを `127.0.0.1` に、ポート、アプリケーション、ストリームキーはOBSの設定と一致させてください。）
